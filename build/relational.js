(()=>{"use strict";const e=window.wp.blocks,t=window.wp.i18n,s=window.wp.blockEditor,o=window.wp.components,r=window.wp.data,l=window.wp.element,a=window.ReactJSXRuntime;(0,e.registerBlockType)("celorgscratch/promocard",{title:(0,t.__)("Promo Card","textdomain"),icon:"index-card",category:"common",attributes:{postId:{type:"number",default:0},postType:{type:"string",default:"post"},postTitle:{type:"string",default:""},postExcerpt:{type:"string",default:""},customImage:{type:"string",default:""},postLink:{type:"string",default:""}},edit:({attributes:e,setAttributes:n})=>{const{postId:i,postType:c,customImage:p}=e,[d,x]=(0,l.useState)(e.postExcerpt);(0,r.useDispatch)("core");const m=(0,r.useSelect)((e=>e("core").getEntityRecords("postType",c,{per_page:100})),[c]),g=m?m.map((e=>({label:e.title.rendered,value:e.id}))):[];return(0,r.useSelect)((t=>{const s=t("core").getEntityRecord("postType","post",e.postId);s&&s.excerpt.rendered!==d&&x(s.excerpt.rendered)})),(0,a.jsxs)("div",{children:[(0,a.jsxs)(s.InspectorControls,{children:[(0,a.jsxs)(o.PanelBody,{title:(0,t.__)("Post Settings","textdomain"),children:[(0,a.jsx)(o.SelectControl,{label:(0,t.__)("Post Type","textdomain"),value:c,options:[{label:"Post",value:"post"},{label:"Page",value:"page"},{label:"Promotions",value:"scratch_promos"},{label:"Routes",value:"route"},{label:"GoSmart",value:"go_smart"}],onChange:e=>n({postType:e})}),(0,a.jsx)(o.SelectControl,{label:(0,t.__)("Post","textdomain"),value:i.toString(),options:[{label:"Select a post",value:""},...g],onChange:e=>(async e=>{if(e!==i&&null!=e){const t=m.find((t=>t.id.toString()===e.toString()));t&&n({postId:t.id,postTitle:t.title.rendered,postExcerpt:t.excerpt.rendered,postLink:t.link})}})(e)})]}),(0,a.jsxs)(o.PanelBody,{title:(0,t.__)("Custom Image","textdomain"),children:[(0,a.jsx)(s.MediaUploadCheck,{children:(0,a.jsx)(s.MediaUpload,{onSelect:e=>n({customImage:e.url}),allowedTypes:["image"],render:({open:e})=>(0,a.jsx)(o.Button,{onClick:e,isDefault:!0,isLarge:!0,children:p?(0,t.__)("Change Image","textdomain"):(0,t.__)("Select Image","textdomain")})})}),p&&(0,a.jsxs)("div",{style:{marginTop:"20px"},children:[(0,a.jsx)("img",{src:p,alt:(0,t.__)("Selected image","textdomain"),style:{width:"100%"}}),(0,a.jsx)(o.Button,{onClick:()=>n({customImage:""}),isLink:!0,isDestructive:!0,children:(0,t.__)("Remove Image","textdomain")})]})]})]}),(0,a.jsx)("div",{className:"custom-card-block",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("figure",{children:p&&(0,a.jsx)("img",{src:p,alt:e.postTitle})}),(0,a.jsxs)("div",{class:"promo_excerpt_wrap",children:[(0,a.jsx)("p",{class:"h3",children:e.postTitle}),(0,a.jsx)("p",{className:"promo_excerpt",dangerouslySetInnerHTML:{__html:d+' <span class="arrow"><svg version="1.1" class="arrow_svg link_arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 22 22" style="enable-background:new 0 0 22 22;" xml:space="preserve"><g class="Forward_arrow" transform="translate(0 2)"><path class="blck_lnk_arrow" d="M11-2L9,0l7.57,7.57H0v2.86h16.57L9,18l2,2L22,9L11-2z"></path></g></svg></span>'}})]})]}):(0,a.jsx)("p",{children:"Select a post to display its card"})})]})},save:({attributes:e})=>{const{customImage:t,postLink:s}=e;return(0,a.jsxs)("div",{className:"custom-card-block",children:[(0,a.jsx)("figure",{children:t&&(0,a.jsx)("img",{src:t,alt:e.postTitle})}),(0,a.jsx)("div",{class:"promo_excerpt_wrap",children:(0,a.jsxs)("a",{href:s,children:[(0,a.jsx)("p",{class:"h3",children:e.postTitle}),(0,a.jsx)("p",{className:"promo_excerpt",dangerouslySetInnerHTML:{__html:e.postExcerpt+' <span class="arrow"><svg version="1.1" class="arrow_svg link_arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 22 22" style="enable-background:new 0 0 22 22;" xml:space="preserve"><g class="Forward_arrow" transform="translate(0 2)"><path class="blck_lnk_arrow" d="M11-2L9,0l7.57,7.57H0v2.86h16.57L9,18l2,2L22,9L11-2z"></path></g></svg></span>'}})]})})]})}})})();